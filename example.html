<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>StyleShifter Example</title>
  <style>
    /* Example CSS with StyleShifter expressions */
    
    body {
      margin: 0;
      padding: 20px;
      font-family: system-ui, -apple-system, sans-serif;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
    }

    .card {
      /*![demo.primaryColor]*/
      background-color: #ffffff;
      
      border-radius: 8px;
      padding: 24px;
      margin-bottom: 16px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .card h2 {
      /*![demo.headingColor]*/
      color: #1a1a1a;
      
      margin-top: 0;
    }

    .card p {
      /*![demo.textColor]*/
      color: #4a4a4a;
      
      /*![toPx(demo.fontSize)]*/
      font-size: 16px;
      
      line-height: 1.6;
    }

    .button {
      /*![demo.accentColor]*/
      background-color: #3b82f6;
      
      /*![demo.buttonTextColor]*/
      color: white;
      
      border: none;
      padding: 12px 24px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.2s;
    }

    .button:hover {
      /*![opacify(demo.accentColor, 0.8)]*/
      background-color: rgba(59, 130, 246, 0.8);
      
      transform: translateY(-1px);
    }

    .button.secondary {
      /*![demo.primaryColor]*/
      background-color: #ffffff;
      
      /*![demo.accentColor]*/
      color: #3b82f6;
      
      /*![printf(1px solid %1, demo.accentColor)]*/
      border: 1px solid #3b82f6;
    }

    .theme-switcher {
      margin-bottom: 24px;
      padding: 16px;
      background: #f5f5f5;
      border-radius: 8px;
    }

    .theme-switcher button {
      margin-right: 8px;
      margin-bottom: 8px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>StyleShifter Example</h1>
    
    <div class="theme-switcher">
      <h3>Select Theme:</h3>
      <button onclick="applyTheme('light')">Light Theme</button>
      <button onclick="applyTheme('dark')">Dark Theme</button>
      <button onclick="applyTheme('blue')">Blue Theme</button>
      <button onclick="removeTheme()">Remove Theme</button>
    </div>

    <div class="card">
      <h2>Welcome to StyleShifter</h2>
      <p>
        This is a demonstration of the StyleShifter theming system. The CSS above contains
        special comments like <code>/*![demo.primaryColor]*/</code> that get replaced with
        theme values at runtime.
      </p>
      <button class="button">Primary Action</button>
      <button class="button secondary">Secondary Action</button>
    </div>

    <div class="card">
      <h2>How It Works</h2>
      <p>
        StyleShifter scans your CSS for expressions in the format <code>/*![expression]*/</code>.
        These can be simple property references or function calls like <code>opacify()</code>,
        <code>tint()</code>, or <code>toPx()</code>.
      </p>
      <p>
        When you apply a theme, it generates CSS overrides scoped to your theme's class name
        and injects them into the document head. Switch themes using the buttons above!
      </p>
    </div>
  </div>

  <script type="module">
    // Import StyleShifter (in production, this would come from npm)
    // For this example, we'll create a simplified inline version
    
    class SimpleTheme {
      constructor(options) {
        this.namespace = options.namespace;
        this.name = options.name;
        this.data = options.data;
      }

      applyTo(element) {
        // Remove other theme classes
        const classes = Array.from(element.classList);
        classes.forEach(cls => {
          if (cls.startsWith(this.namespace + '-')) {
            element.classList.remove(cls);
          }
        });
        
        element.classList.add(`${this.namespace}-${this.name}`);
      }

      removeFrom(element) {
        element.classList.remove(`${this.namespace}-${this.name}`);
      }
    }

    // Create themes
    const lightTheme = new SimpleTheme({
      namespace: 'demo',
      name: 'light',
      data: {
        primaryColor: '#ffffff',
        headingColor: '#1a1a1a',
        textColor: '#4a4a4a',
        accentColor: '#3b82f6',
        buttonTextColor: '#ffffff',
        fontSize: 16
      }
    });

    const darkTheme = new SimpleTheme({
      namespace: 'demo',
      name: 'dark',
      data: {
        primaryColor: '#1a1a1a',
        headingColor: '#ffffff',
        textColor: '#e5e5e5',
        accentColor: '#60a5fa',
        buttonTextColor: '#1a1a1a',
        fontSize: 16
      }
    });

    const blueTheme = new SimpleTheme({
      namespace: 'demo',
      name: 'blue',
      data: {
        primaryColor: '#dbeafe',
        headingColor: '#1e3a8a',
        textColor: '#1e40af',
        accentColor: '#2563eb',
        buttonTextColor: '#ffffff',
        fontSize: 18
      }
    });

    const themes = { light: lightTheme, dark: darkTheme, blue: blueTheme };
    let currentTheme = null;

    window.applyTheme = function(themeName) {
      const theme = themes[themeName];
      if (theme) {
        if (currentTheme) {
          currentTheme.removeFrom(document.body);
        }
        theme.applyTo(document.body);
        currentTheme = theme;
        
        // In a real implementation, CSSProcessor would generate these overrides
        // For demo purposes, we'll inject them manually
        injectThemeStyles(theme);
      }
    };

    window.removeTheme = function() {
      if (currentTheme) {
        currentTheme.removeFrom(document.body);
        currentTheme = null;
        
        // Remove injected styles
        const styleEl = document.getElementById('theme-overrides');
        if (styleEl) styleEl.remove();
      }
    };

    function injectThemeStyles(theme) {
      const css = `
        .${theme.namespace}-${theme.name} .card {
          background-color: ${theme.data.primaryColor};
        }
        
        .${theme.namespace}-${theme.name} .card h2 {
          color: ${theme.data.headingColor};
        }
        
        .${theme.namespace}-${theme.name} .card p {
          color: ${theme.data.textColor};
          font-size: ${theme.data.fontSize}px;
        }
        
        .${theme.namespace}-${theme.name} .button {
          background-color: ${theme.data.accentColor};
          color: ${theme.data.buttonTextColor};
        }
        
        .${theme.namespace}-${theme.name} .button:hover {
          background-color: ${theme.data.accentColor}cc;
        }
        
        .${theme.namespace}-${theme.name} .button.secondary {
          background-color: ${theme.data.primaryColor};
          color: ${theme.data.accentColor};
          border: 1px solid ${theme.data.accentColor};
        }
      `;

      let styleEl = document.getElementById('theme-overrides');
      if (!styleEl) {
        styleEl = document.createElement('style');
        styleEl.id = 'theme-overrides';
        document.head.appendChild(styleEl);
      }
      styleEl.innerHTML = css;
    }

    console.log('StyleShifter example loaded. Try switching themes!');
  </script>
</body>
</html>
